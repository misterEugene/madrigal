## План реализации кейса "Мадригал" за 48 часов (одиночный хакатон)

**Цель:** Создать минимально жизнеспособный прототип (MVP) файрвола на основе eBPF, соответствующий требованиям кейса.

**Основные навыки:** Javascript, Python, Node.js, Linux Ubuntu (хорошая база!), eBPF (нужно быстро изучить).

**Выбор технологий (для максимальной скорости):**

*   **Язык eBPF:** C (напрямую, для оптимальной производительности, хотя требует больше времени на освоение)
*   **Библиотека eBPF:** `libbpf` (прямое взаимодействие с eBPF, требует C, но дает полный контроль)
*   **Пользовательский интерфейс (userspace):** Python (для быстрого прототипирования)
*   **Конфигурация:** YAML (просто и понятно)
*   **Тестирование:** `curl`, `ping`, `tcpdump`
*   **Контейнеризация:** Docker (если останется время)

**Разбивка по времени:**

**День 1 (24 часа):**

*   **0-2 часа: Исследование и планирование (Критически важно!)**
    *   **Что нужно изучить:**
        *   **eBPF:**
            *   Базовые концепции: что это, как работает, для чего используется.
            *   `libbpf`: как с ней работать, как загружать и запускать eBPF-программы.  Особенно важно понять как работают BPF Maps.
            *   XDP (Express Data Path): как быстро сбрасывать пакеты на сетевом уровне.
            *   Как анализировать заголовки пакетов (TCP, IP, HTTP).
        *   **Примеры кода eBPF:**  Поищите примеры фильтрации трафика, логирования, и т.д.  Особенно ищите примеры с `libbpf`.
        *   Документация `libbpf`.
    *   **Планирование архитектуры:**
        *   Схема взаимодействия eBPF-программы и пользовательского интерфейса.
        *   Формат конфигурационного файла.
        *   Список задач и подзадач.
    *   **Инструменты:**
        *   Установите `libbpf`.

*   **2-8 часов: Разработка eBPF-программы (базовый фильтр)**
    *   Написать eBPF-программу на C, которая:
        *   Перехватывает все пакеты.
        *   Пропускает HTTP/HTTPS пакеты на портах 80 и 443.
        *   Сбрасывает все остальные пакеты (используя `XDP_DROP`).
    *   Скомпилировать eBPF-программу.
    *   Настроить `tc` для загрузки eBPF-программы.

*   **8-12 часов: Пользовательский интерфейс (Python + libbpf)**
    *   Написать Python-скрипт, который:
        *   Загружает и запускает скомпилированную eBPF-программу в ядро.
        *   Проверяет, что программа успешно запущена.
        *   Выводит базовую информацию (например, "Файрвол запущен").

*   **12-16 часов: Тестирование базовой функциональности**
    *   Использовать `curl` и `ping` для проверки фильтрации трафика.
    *   Убедиться, что HTTP/HTTPS трафик проходит на портах 80 и 443.
    *   Убедиться, что другой трафик блокируется.

*   **16-24 часа: Реализация логирования (базовое)**
    *   Добавить в eBPF-программу код для логирования IP-адресов заблокированных пакетов в BPF Map.
    *   Добавить в Python-скрипт код для чтения данных из BPF Map и вывода их в консоль.

**День 2 (24 часа):**

*   **0-4 часа: Конфигурация (YAML)**
    *   Реализовать чтение разрешенных портов из YAML-файла.
    *   Изменить Python-скрипт, чтобы он передавал эти порты в eBPF-программу.
    *   Добавить комментарии в коде.

*   **4-8 часов: Расширенное тестирование и отладка**
    *   Более тщательное тестирование с разными портами и протоколами.
    *   Использование `tcpdump` для анализа трафика и отладки проблем.

*   **8-12 часов: Анализ Payload (минимум)**
    *   Добавить в eBPF-программу проверку payload пакетов, идущих не через HTTP/HTTPS на "простое" TCP.
    *   Если пакеты TCP не содержат сигнатур HTTP (GET, POST, HTTP/1.1), сбрасывать их.
    *   Реализовать логирование payload.

*   **12-16 часов: Полировка и документация**
    *   Очистка кода, добавление комментариев.
    *   Написание README.md с инструкциями по запуску и использованию.

*   **16-20 часов: Опционально: CLI**
    *   Заменить YAML-файл CLI, если останется время

*   **20-24 часа: Подготовка презентации и отчета**
    *   Подготовка краткой презентации о вашем решении.
    *   Написание отчета о проделанной работе, проблемах и решениях.
    
**Ключевые моменты:**

*   **Не тратьте время на перфекционизм:** Сосредоточьтесь на создании работающего MVP, а не на идеальном коде.
*   **Используйте готовые решения:** Не изобретайте велосипед, используйте готовые библиотеки и примеры кода.
*   **Тестируйте постоянно:** Проверяйте работоспособность каждой функции сразу после ее реализации.
*   **Тайм-менеджмент:** Строго соблюдайте график, чтобы успеть выполнить все основные задачи.
*   **Документируйте свой код:** Это поможет вам (и судьям) понять, что вы сделали.
*   **Сосредоточьтесь на главных задачах:** Убедитесь, что блокировка/разрешение трафика работают корректно и что ведется логирование.
*   **Проверка Payload:** реализовать минимальную проверку.

**Чего стоит избегать:**

*   Тратить слишком много времени на изучение теории.
*   Пытаться реализовать слишком много функций.
*   Застревать на сложных проблемах.  Если не можете что-то решить, попробуйте упростить задачу.

Удачи на хакатоне!
